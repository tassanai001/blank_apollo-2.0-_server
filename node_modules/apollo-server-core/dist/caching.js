"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function calculateCacheControlHeaders(responses) {
    let lowestMaxAge = Number.MAX_VALUE;
    let publicOrPrivate = 'public';
    for (let i = 0; i < responses.length; i++) {
        const response = responses[i];
        const cacheControl = response.extensions && response.extensions.cacheControl;
        if (!cacheControl ||
            !cacheControl.hints ||
            cacheControl.hints.length === 0 ||
            cacheControl.version !== 1) {
            if (cacheControl && cacheControl.version !== 1) {
                console.warn('Invalid cacheControl version.');
            }
            return {};
        }
        const rootHints = new Set();
        for (let j = 0; j < cacheControl.hints.length; j++) {
            const hint = cacheControl.hints[j];
            if (hint.scope && hint.scope.toLowerCase() === 'private') {
                publicOrPrivate = 'private';
            }
            if (hint.maxAge === undefined) {
                continue;
            }
            if (hint.maxAge === 0) {
                return {};
            }
            if (hint.maxAge < lowestMaxAge) {
                lowestMaxAge = hint.maxAge;
            }
            if (hint.path.length === 1) {
                rootHints.add(hint.path[0]);
            }
        }
        if (Object.keys(response.data).find(rootKey => !rootHints.has(rootKey))) {
            return {};
        }
    }
    return {
        'Cache-Control': `max-age=${lowestMaxAge}, ${publicOrPrivate}`,
    };
}
exports.calculateCacheControlHeaders = calculateCacheControlHeaders;
//# sourceMappingURL=caching.js.map